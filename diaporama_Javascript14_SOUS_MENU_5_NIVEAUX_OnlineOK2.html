<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Menu Responsive Accordéon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .dropdown-submenu {
      position: relative;
    }
    .dropdown-submenu .dropdown-menu {
      top: 0;
      left: 100%;
      margin-top: -1px;
      /* AJOUTS POUR SUPPRIMER L'ESPACE */
      padding: 0;
      margin: 0;
    }
    .dropdown-submenu .dropdown-menu li {
      margin-bottom: 0;
    }

    /* Desktop hover */
    @media (min-width: 992px) {
      .dropdown-submenu:hover > .dropdown-menu {
        display: block;
      }
    }

    /* Mobile/tablette accordéon */
    @media (max-width: 991.98px) {
      .dropdown-menu {
        display: none;
      }
      .dropdown-menu.show {
        display: block;
      }
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Mon Logo</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link active" href="#">Accueil</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Services</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Service 1</a></li>
            <li class="dropdown-submenu dropend">
              <a class="dropdown-item dropdown-toggle" href="#">Service 2</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Sous-service A</a></li>
                <li class="dropdown-submenu dropend">
                  <a class="dropdown-item dropdown-toggle" href="#">Sous-service B</a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">B - 1</a></li>
                    <li class="dropdown-submenu dropend">
                      <a class="dropdown-item dropdown-toggle" href="#">B - 2</a>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">B - 2 - 1</a></li>
                        <li><a class="dropdown-item" href="#">B - 2 - 2</a></li>
                        <li><a class="dropdown-item" href="#">B - 2 - 3</a></li>
                        <li><a class="dropdown-item" href="#">B - 2 - 4</a></li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a class="dropdown-item" href="#">Service 3</a></li>
          </ul>
        </li>
        <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
      </ul>
    </div>
  </div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/*
    document.addEventListener("DOMContentLoaded", function () {
        if (window.innerWidth < 992) {
            document.querySelectorAll('.dropdown-submenu > a').forEach(function (trigger) {
                trigger.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const submenu = this.nextElementSibling;
                    const parentMenu = this.closest('.dropdown-menu');
                    parentMenu.querySelectorAll('.dropdown-menu.show').forEach(function (openMenu) {
                        if (openMenu !== submenu) {
                            openMenu.classList.remove('show');
                        }
                    });
                    submenu.classList.toggle('show');
                });
            });

            document.querySelectorAll('.dropdown-submenu').forEach(function(submenuItem) {
                submenuItem.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            });
        }
    });
*/




/*
PROBLEME RENCONTRE :

Pouvez vous corriger le point suivant :


On utilise uniquement le navigateur comme mozilla firefox.


Quand l'affichage de Mozilla Firefox correspond à la largeur de l'écran d'un DEKTOP alors quand on clique sur le menu "Service 2" alors les sous menus correspondant au menu "Service 2" s'affichent c'est-à-dire les sous menus "Sous-service A" et "Sous-service B" s'affichent correctement.


Mais quand on redimensionne la LARGEUR du navigateur MOZILLA FIREFOX avec la LARGEUR de la TABLETTE ou la LARGEUR du SMARTPHONE puis qu'on CLIQUE ENSUITE sur le menu "Service 2" alors les sous menus correspondant au menu "Service 2" ne s'affichent pas c'est-à-dire les sous menus "Sous-service A" et "Sous-service B" ne s'affichent pas. 


Alors que si on actualise ensuite le navigateur MOZILLA FIREFOX alors c'est uniquement de cette façon que les sous menus "Sous-service A" et "Sous-service B" s'affichent parfaitement après le redimensionnement du navigateur MOZILLA FIREFOX en partant depuis la largeur de l'écran DESKTOP vers la LARGEUR de l'écran TABLETTE ou SMARTPHONE.


Pouvez vous corriger ce problème sans avoir à reloader la navigateur mozilla firefox ? 
*/	



/*
C'est un problème courant de comportement de menu déroulant (dropdown) dans Bootstrap lors du redimensionnement de la fenêtre. Le souci est que le code JavaScript pour gérer l'ouverture du sous-menu en mode mobile n'est pas réévalué automatiquement lorsque la taille de la fenêtre change. Le code d'origine ne prend en charge que la taille initiale de la fenêtre.

Pour résoudre ce problème sans recharger la page, on doit ajouter un écouteur d'événement sur le redimensionnement de la fenêtre. Cet écouteur va désactiver l'événement click sur le menu déroulant en mode mobile, puis le réactiver lorsque l'écran est suffisamment large. Voici la correction à apporter.

Explication de la correction

Le code JavaScript d'origine utilise if (window.innerWidth < 992) pour définir le comportement du menu. Cependant, cette condition n'est vérifiée qu'une seule fois au chargement de la page (DOMContentLoaded). Pour qu'elle soit évaluée à chaque redimensionnement, nous devons l'intégrer dans un événement resize.

La solution consiste à utiliser la fonction matchMedia() qui est une API moderne pour détecter les changements de média (comme la largeur de l'écran). Cela permet de ne pas surcharger l'application en évaluant du code à chaque pixel de changement, mais plutôt lorsque les conditions de la media query changent.

Voici le code corrigé :
*/
	
	


document.addEventListener("DOMContentLoaded", function () {
    const mediaQuery = window.matchMedia('(max-width: 991.98px)');

    function handleMediaQueryChange(e) {
        // e.matches est vrai si la condition est remplie (mode mobile/tablette)
        if (e.matches) {
            // Mode mobile/tablette : on gère l'accordéon
            document.querySelectorAll('.dropdown-submenu > a').forEach(function (trigger) {
                trigger.addEventListener('click', handleMobileClick);
            });
        } else {
            // Mode bureau : on désactive la gestion manuelle du clic
            document.querySelectorAll('.dropdown-submenu > a').forEach(function (trigger) {
                trigger.removeEventListener('click', handleMobileClick);
                // Ferme les sous-menus ouverts s'il y en a
                const submenu = trigger.nextElementSibling;
                if (submenu) {
                    submenu.classList.remove('show');
                }
            });
        }
    }

    function handleMobileClick(e) {
        e.preventDefault();
        e.stopPropagation();
        const submenu = this.nextElementSibling;
        const parentMenu = this.closest('.dropdown-menu');
        
        // Ferme les autres sous-menus ouverts
        parentMenu.querySelectorAll('.dropdown-menu.show').forEach(function (openMenu) {
            if (openMenu !== submenu) {
                openMenu.classList.remove('show');
            }
        });
        
        submenu.classList.toggle('show');
    }

    // Gère le comportement initial au chargement de la page
    handleMediaQueryChange(mediaQuery);

    // Ajoute un écouteur pour les changements de média
    mediaQuery.addEventListener('change', handleMediaQueryChange);

    // Empêche la propagation du clic sur les éléments de sous-menu pour ne pas fermer le menu principal
    document.querySelectorAll('.dropdown-submenu').forEach(function(submenuItem) {
        submenuItem.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    });
});	



/*
Étapes à suivre pour appliquer la correction

    Copiez le bloc de code JavaScript ci-dessus.

    Remplacez le second bloc <script> existant dans votre code HTML par le nouveau code.

Ce nouveau script est plus robuste. Il utilise l'événement change sur la media query pour réagir dynamiquement aux redimensionnements, assurant que le menu se comporte comme attendu, que ce soit sur un ordinateur de bureau, une tablette ou un smartphone, sans avoir à recharger la page.
*/
</script>

</body>
</html>